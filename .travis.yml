language: go

go:
  - 1.19.5

services:
  - mysql
  - postgresql

before_install:
  - docker-compose up -d
  - docker ps -a
  - mysql -e "CREATE DATABASE miga;"
  - mysql -e "CREATE USER user@localhost IDENTIFIED BY 'password'";
  - mysql -e "GRANT ALL ON miga.* TO user@localhost";
  - psql -U postgres -c 'CREATE DATABASE miga;'
  - psql -U postgres -c "CREATE USER \"user\" WITH PASSWORD 'password'";
  - docker run -d --rm=true -p 5433:5433 --name=miga-vertica dataplatform/docker-vertica

install:
  - make build

script:
  - make test
